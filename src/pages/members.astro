---

import { sortMembersByTeam } from "../scripts/sortTeams.ts";
import path from "path"
import "../styles/global.css";
import "../styles/members.css";
import {fetchMembers} from "../scripts/serveMembers"
import Layout from "../layouts/layout.astro";
import TeamDisplayLeft from "../components/TeamDisplayLeft.astro";
import TeamDisplayRight from "../components/TeamDisplayRight.astro";
import ProjectTeam from "../components/ProjectTeam.tsx";
import { getTeamsDescriptions } from "../scripts/getTeamDescription";
let members = await fetchMembers(); // Call the new function
import type { memberData } from "../types/memberData";



type TeamDescriptions = {
  name: string;
  description?: string;
  tags?: string;
}

type Team = {
  teamName: string;
  members: memberData[];
  description: string | undefined;
}

let { teamsDict, projects } =
    sortMembersByTeam(members);
let teamDescription: TeamDescriptions[] = await getTeamsDescriptions();

function mapTeamWithDesc(teams: {[teamName: string]: memberData[]}, teamDescription: TeamDescriptions[]) {
  return Object.keys(teams)
      .map(teamName => {
        const description = teamDescription.find((desc: TeamDescriptions) => desc.name === teamName);
        if (description) {
          return {
            teamName,
            members: teams[teamName],
            description: description.description
          };
        }
        return null;
      })
      .filter(Boolean);
}

let teamWithDesc = mapTeamWithDesc(teamsDict, teamDescription);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Members Page</title>
  </head>
  <section class="section-background">
  <Layout>
  
      
    <!-- <BlobBackground zIndexVal="-10" offset="-100"/>
    <BlobBackground zIndexVal="-10" offset="900"/> -->
    
    <object data="..\public\assets\YOO_members_bg.svg"> </object>
    <div class="nav">
      <button class="lead-button"
        ><a href="#leadership-section">LEADERSHIP</a></button
      >
      <button class="com-button"
        ><a href="#com-section">COMMUNICATIONS</a></button
      >
      <button class="proj-button"><a href="#proj-section">PROJECTS</a></button>
    </div>
    <!-- <div class="shapedividers_com-9592"></div> -->

    <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
    <!-- function for the scroll up button -->
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        const myButton = document.getElementById("myBtn") as HTMLButtonElement;

        window.onscroll = function () {
          scrollFunction();
        };

        function scrollFunction() {
          if (
            document.body.scrollTop > 20 ||
            document.documentElement.scrollTop > 20
          ) {
            myButton.style.display = "block";
          } else {
            myButton.style.display = "none";
          }
        }

        myButton.onclick = function () {
          topFunction();
        };

        function topFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }
      });
    </script>
    {teamWithDesc.map((team: Team, index: number) => (
      index % 2 === 0 ?
          <TeamDisplayLeft teamName={team.teamName} team={team.members} teamDescription={team.description} /> :
          <TeamDisplayRight teamName={team.teamName} team={team.members} teamDescription={team.description} />
    ))}
    <ProjectTeam client:only="react" projects={projects} />
  </Layout>
</section>
</html>
